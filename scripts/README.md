# æ•°æ®åº“ç®¡ç†è„šæœ¬ä½¿ç”¨æŒ‡å—

## å‰ç½®å‡†å¤‡

åœ¨ä½¿ç”¨è„šæœ¬å‰ï¼Œè¯·ç¡®ä¿ `.env.local` ä¸­é…ç½®äº†ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```env
# Supabase API é…ç½®
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# æ•°æ®åº“ç›´è¿é…ç½®ï¼ˆç”¨äºæ‰§è¡Œ SQLï¼‰
DATABASE_URL=postgresql://postgres:[YOUR-PASSWORD]@[HOST]:[PORT]/postgres

# AI é…ç½®ï¼ˆç”¨äºç”Ÿæˆ Embeddingï¼‰
ZHIPU_API_KEY=your-zhipu-api-key
```

> ğŸ’¡ **å¦‚ä½•è·å– DATABASE_URLï¼Ÿ**
> 
> 1. æ‰“å¼€ Supabase Dashboard
> 2. è¿›å…¥ Project Settings â†’ Database
> 3. æ‰¾åˆ° **Connection String** éƒ¨åˆ†
> 4. é€‰æ‹© **URI** æ ¼å¼ï¼Œå¤åˆ¶ç²˜è´´å³å¯

---

## å¯ç”¨å‘½ä»¤

### 1. `npm run db:setup` - ğŸš€ é¦–æ¬¡åˆå§‹åŒ–
**åŠŸèƒ½**ï¼šå®Œæ•´åˆå§‹åŒ–æ•°æ®åº“ï¼ˆè‡ªåŠ¨å»ºè¡¨ + æ³¨å…¥ç§å­æ•°æ®ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… ç¬¬ä¸€æ¬¡éƒ¨ç½²é¡¹ç›®
- âœ… æ–°äººå…‹éš†é¡¹ç›®åæœ¬åœ°åˆå§‹åŒ–

**æ‰§è¡Œå†…å®¹**ï¼š
1. è‡ªåŠ¨æ‰§è¡Œ `schema.sql`ï¼ˆåˆ›å»ºè¡¨ã€ç´¢å¼•ã€å‡½æ•°ï¼‰
2. è‡ªåŠ¨æ³¨å…¥ç§å­æ•°æ®

---

### 2. `npm run db:rebuild` - ğŸ”„ å®Œå…¨é‡å»º
**åŠŸèƒ½**ï¼šåˆ é™¤å¹¶é‡å»ºæ‰€æœ‰è¡¨å’Œæ•°æ®

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… ä¿®æ”¹äº† `schema.sql` ä¸­çš„è¡¨ç»“æ„
- âœ… éœ€è¦å½»åº•æ¸…ç†æ•°æ®åº“é‡æ–°å¼€å§‹
- âš ï¸ **å±é™©æ“ä½œ**ï¼šä¼šåˆ é™¤æ‰€æœ‰æ•°æ®ï¼

**æ‰§è¡Œå†…å®¹**ï¼š
1. åˆ é™¤æ‰€æœ‰è¡¨ï¼ˆ`DROP TABLE`ï¼‰
2. é‡æ–°åˆ›å»ºè¡¨ç»“æ„
3. æ³¨å…¥ç§å­æ•°æ®

---

### 3. `npm run db:reset` - ğŸ—‘ï¸ é‡ç½®æ•°æ®
**åŠŸèƒ½**ï¼šä»…æ¸…ç©ºæ•°æ®ï¼Œä¿ç•™è¡¨ç»“æ„

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… è¡¨ç»“æ„æ²¡å˜ï¼Œåªæƒ³æ¸…ç©ºæ•°æ®
- âœ… æµ‹è¯•å®Œæƒ³æ¢å¤å¹²å‡€çŠ¶æ€

**æ‰§è¡Œå†…å®¹**ï¼š
1. æ¸…ç©º `messages` è¡¨
2. æ¸…ç©º `documents` è¡¨

---

### 4. `npm run db:seed` - ğŸŒ± æ³¨å…¥ç§å­æ•°æ®
**åŠŸèƒ½**ï¼šä»…æ³¨å…¥ç§å­æ•°æ®ï¼ˆä¸æ”¹è¡¨ç»“æ„ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… æ›´æ–°äº†ç®€å†å†…å®¹ï¼ˆä¿®æ”¹ `scripts/seed.ts`ï¼‰
- âœ… æƒ³æ·»åŠ æ›´å¤šæµ‹è¯•æ•°æ®

**æ‰§è¡Œå†…å®¹**ï¼š
1. è¯»å– `scripts/seed.ts` ä¸­çš„ `myResume` æ•°ç»„
2. ç”Ÿæˆ Embeddingï¼ˆè°ƒç”¨æ™ºè°± AIï¼‰
3. æ’å…¥åˆ° `documents` è¡¨

---

### 5. `npm run db:clear` - ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ•°æ®
**åŠŸèƒ½**ï¼šåŒ `db:reset`ï¼Œæ¸…ç©ºæ‰€æœ‰æ•°æ®

---

## å¸¸è§ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šæˆ‘æ›´æ–°äº†ç®€å†å†…å®¹
**æ­¥éª¤**ï¼š
```bash
# 1. ç¼–è¾‘ scripts/seed.tsï¼Œä¿®æ”¹ myResume æ•°ç»„
# 2. æ¸…ç©ºæ—§æ•°æ®
npm run db:reset

# 3. é‡æ–°æ³¨å…¥æ–°æ•°æ®
npm run db:seed
```

---

### åœºæ™¯ 2ï¼šæˆ‘æƒ³å¢åŠ å­—æ®µ
**ç¤ºä¾‹**ï¼šç»™ `documents` è¡¨å¢åŠ ä¸€ä¸ª `category` å­—æ®µ

**æ­¥éª¤**ï¼š
```bash
# 1. ç¼–è¾‘ scripts/schema.sqlï¼Œä¿®æ”¹è¡¨å®šä¹‰
# ä¾‹å¦‚ï¼šALTER TABLE documents ADD COLUMN category TEXT;

# 2. å®Œå…¨é‡å»ºæ•°æ®åº“
npm run db:rebuild
```

> âš ï¸ **æ³¨æ„**ï¼šå¦‚æœçº¿ä¸Šå·²æœ‰é‡è¦æ•°æ®ï¼Œè¯·ä½¿ç”¨æ•°æ®åº“è¿ç§»å·¥å…·ï¼ˆå¦‚ Supabase Migrationsï¼‰ï¼Œè€Œä¸æ˜¯ rebuildï¼

---

### åœºæ™¯ 3ï¼šæˆ‘æ”¹äº†å‘é‡ç»´åº¦
**ç¤ºä¾‹**ï¼šä»æ™ºè°±çš„ 2048 ç»´æ¢æˆ OpenAI çš„ 1536 ç»´

**æ­¥éª¤**ï¼š
```bash
# 1. ä¿®æ”¹ scripts/schema.sql
# å°† vector(2048) æ”¹ä¸º vector(1536)

# 2. ä¿®æ”¹ scripts/seed.ts
# æ›´æ¢ embedding æ¨¡å‹

# 3. å®Œå…¨é‡å»º
npm run db:rebuild
```

---

### åœºæ™¯ 4ï¼šæˆ‘æƒ³æ–°å¢ä¸€å¼ è¡¨
**ç¤ºä¾‹**ï¼šå¢åŠ  `users` è¡¨

**æ­¥éª¤**ï¼š
```bash
# 1. åœ¨ scripts/schema.sql ä¸­æ·»åŠ  CREATE TABLE users (...);

# 2. ï¼ˆå¯é€‰ï¼‰åœ¨ scripts/seed.ts ä¸­æ·»åŠ  users çš„ç§å­æ•°æ®

# 3. å®Œå…¨é‡å»º
npm run db:rebuild
```

---

## ç›®å½•ç»“æ„

```
scripts/
â”œâ”€â”€ schema.sql       # æ•°æ®åº“è¡¨ç»“æ„å®šä¹‰ï¼ˆDDLï¼‰
â”œâ”€â”€ seed.ts          # ç§å­æ•°æ®æ³¨å…¥é€»è¾‘ï¼ˆDMLï¼‰
â”œâ”€â”€ db-manager.ts    # æ•°æ®åº“ç®¡ç†å…¥å£
â””â”€â”€ README.md        # æœ¬æ–‡æ¡£
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼š`DATABASE_URL` æœªæ‰¾åˆ°
**é”™è¯¯ä¿¡æ¯**ï¼š
```
âŒ é”™è¯¯ï¼šæœªæ‰¾åˆ° DATABASE_URL ç¯å¢ƒå˜é‡ï¼
```

**è§£å†³æ–¹æ³•**ï¼š
åœ¨ `.env.local` ä¸­æ·»åŠ  `DATABASE_URL`ï¼Œæ ¼å¼ç¤ºä¾‹ï¼š
```env
DATABASE_URL=postgresql://postgres:your-password@db.xxx.supabase.co:5432/postgres
```

---

### é—®é¢˜ 2ï¼šSSL è¿æ¥å¤±è´¥
**é”™è¯¯ä¿¡æ¯**ï¼š
```
error: no pg_hba.conf entry for host
```

**è§£å†³æ–¹æ³•**ï¼š
ç¡®ä¿ `db-manager.ts` ä¸­å·²é…ç½® `ssl: 'require'`ï¼ˆå·²é»˜è®¤é…ç½®ï¼‰

---

### é—®é¢˜ 3ï¼šEmbedding ç”Ÿæˆå¤±è´¥
**é”™è¯¯ä¿¡æ¯**ï¼š
```
âŒ è°ƒç”¨å¤±è´¥: API key is invalid
```

**è§£å†³æ–¹æ³•**ï¼š
æ£€æŸ¥ `.env.local` ä¸­çš„ `ZHIPU_API_KEY` æ˜¯å¦æ­£ç¡®

